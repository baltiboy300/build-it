<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IILM University Portal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Changed font to Plus Jakarta Sans for premium academic feel */
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .hidden { display: none !important; }
        
        /* Mentor Card specific styles */
        .mentor-card-avatar {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.125rem;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800">

    <!-- App Container -->
    <div id="app" class="h-screen flex flex-col overflow-hidden">
        
        <!-- Toast Notification Container (Fixed) -->
        <div id="toast-container" class="fixed bottom-6 right-6 z-50 flex flex-col gap-2 pointer-events-none"></div>

        <!-- Loading Spinner -->
        <div id="loading-screen" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-slate-50">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-slate-200 border-t-indigo-600 mb-4"></div>
            <p class="text-slate-400 font-bold text-xs uppercase tracking-widest animate-pulse">Initializing IILM Cloud...</p>
        </div>

        <!-- Role Selection / Login View -->
        <div id="login-view" class="hidden h-full flex items-center justify-center p-4 overflow-y-auto">
            <div class="max-w-5xl w-full bg-white rounded-[2rem] shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[600px] border border-slate-100">
                <div class="md:w-5/12 bg-indigo-600 p-12 text-white flex flex-col justify-between relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                        <svg width="100%" height="100%"><defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="currentColor" stroke-width="1"/></pattern></defs><rect width="100%" height="100%" fill="url(#grid)" /></svg>
                    </div>

                    <div class="relative z-10">
                        <div onclick="window.history.back()" title="Go Back" class="bg-white/10 w-14 h-14 rounded-2xl flex items-center justify-center mb-8 cursor-pointer hover:bg-white/20 transition-all backdrop-blur-sm group">
                            <i data-lucide="graduation-cap" class="w-8 h-8 group-hover:scale-110 transition-transform"></i>
                        </div>
                        <h1 class="text-4xl font-extrabold mb-4 leading-tight tracking-tight">IILM<br>University</h1>
                        <p class="text-indigo-100 text-lg font-medium leading-relaxed">Empowering the next generation of leaders with seamless academic connectivity.</p>
                    </div>
                    
                    <div class="relative z-10 pt-8 border-t border-white/10">
                        <div class="flex items-center gap-3 text-xs font-bold uppercase tracking-widest text-indigo-200">
                            <i data-lucide="shield-check" class="w-4 h-4"></i> Secure Portal
                        </div>
                    </div>
                </div>
                
                <div class="md:w-7/12 p-12 flex flex-col justify-center bg-white" id="login-form-container">
                    <div id="role-selection" class="space-y-8 max-w-md mx-auto w-full">
                        <div class="text-center">
                            <h2 class="text-2xl font-bold text-slate-900">Welcome Back</h2>
                            <p class="text-slate-500">Select your access level to continue</p>
                        </div>
                        <div class="space-y-4">
                            <button onclick="handleRoleSelect('mentor')" class="w-full flex items-center gap-5 p-5 border border-slate-200 rounded-2xl hover:border-indigo-600 hover:bg-indigo-50/50 hover:shadow-lg hover:shadow-indigo-100 transition-all text-left group">
                                <div class="bg-indigo-100 p-3.5 rounded-xl text-indigo-600 group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                                    <i data-lucide="briefcase" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-slate-800 text-lg">Academic Mentor</div>
                                    <div class="text-sm text-slate-400 font-medium">Faculty Access</div>
                                </div>
                                <i data-lucide="chevron-right" class="ml-auto w-5 h-5 text-slate-300 group-hover:text-indigo-600 transition-colors"></i>
                            </button>
                            <button onclick="handleRoleSelect('mentee')" class="w-full flex items-center gap-5 p-5 border border-slate-200 rounded-2xl hover:border-emerald-500 hover:bg-emerald-50/50 hover:shadow-lg hover:shadow-emerald-100 transition-all text-left group">
                                <div class="bg-emerald-100 p-3.5 rounded-xl text-emerald-600 group-hover:bg-emerald-500 group-hover:text-white transition-colors">
                                    <i data-lucide="book-open" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-slate-800 text-lg">Student Mentee</div>
                                    <div class="text-sm text-slate-400 font-medium">Student Access</div>
                                </div>
                                <i data-lucide="chevron-right" class="ml-auto w-5 h-5 text-slate-300 group-hover:text-emerald-500 transition-colors"></i>
                            </button>
                        </div>
                    </div>
                    <div id="verification-step" class="hidden text-center fade-in max-w-md mx-auto w-full">
                        <button onclick="resetRole()" class="text-slate-500 font-semibold text-sm mb-8 flex items-center gap-2 mx-auto hover:text-indigo-600 transition-colors">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> Back
                        </button>
                        <h2 id="role-title" class="text-2xl font-bold text-slate-900 mb-2 capitalize">Verification</h2>
                        <p class="text-slate-500 mb-8">Please complete the security check.</p>
                        <div class="flex justify-center mb-8 bg-slate-50 p-4 rounded-2xl border border-slate-100">
                            <div class="pe_verify_email" data-client-id="13401266232106403409"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Portal Layout (Shared Wrapper) -->
        <div id="portal-layout" class="hidden flex h-full overflow-hidden bg-slate-50/50">
            <!-- Sidebar Navigation -->
            <aside class="w-72 bg-white border-r border-slate-200 flex flex-col shrink-0 z-20 shadow-sm">
                <div class="p-6 border-b border-slate-100">
                    <div class="flex items-center gap-3 text-indigo-700 font-bold text-xl tracking-tight">
                        <div class="bg-indigo-600 text-white p-1.5 rounded-lg">
                            <i data-lucide="graduation-cap" class="w-6 h-6"></i>
                        </div>
                        <span>IILM University</span>
                    </div>
                </div>
                
                <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto" id="sidebar-nav"></nav>

                <div class="p-4 border-t border-slate-100 bg-slate-50/50">
                    <div class="flex items-center gap-3 p-2 rounded-xl">
                        <div id="sidebar-avatar" class="w-10 h-10 rounded-full bg-indigo-600 text-white flex items-center justify-center font-bold text-sm uppercase shadow-md shadow-indigo-200"></div>
                        <div class="overflow-hidden">
                            <p id="sidebar-name" class="text-sm font-bold text-slate-900 truncate">User Name</p>
                            <p id="sidebar-role" class="text-[10px] font-bold text-slate-500 uppercase tracking-wide truncate">Role</p>
                        </div>
                    </div>
                    <button onclick="logout()" class="mt-3 w-full flex items-center justify-center gap-2 px-4 py-2 text-red-600 text-sm font-semibold hover:bg-red-50 rounded-lg transition-colors">
                        <i data-lucide="log-out" class="w-4 h-4"></i> Sign Out
                    </button>
                </div>
            </aside>

            <!-- Main Content Area -->
            <div class="flex-1 flex flex-col h-full overflow-hidden relative">
                <header class="h-16 bg-white/80 backdrop-blur-md border-b border-slate-200 flex items-center justify-between px-8 shrink-0 z-10">
                    <h2 id="page-title" class="text-lg font-bold text-slate-800">Dashboard</h2>
                    <div class="flex items-center gap-4">
                        <button class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 hover:bg-indigo-50 hover:text-indigo-600 transition-colors relative">
                            <i data-lucide="bell" class="w-4 h-4"></i>
                            <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
                        </button>
                    </div>
                </header>

                <main class="flex-1 overflow-y-auto p-8 relative" id="main-content-area">
                    
                    <!-- View: Dashboard (Dynamic: Mentor vs Mentee) -->
                    <div id="view-dashboard" class="max-w-7xl mx-auto space-y-8 fade-in">
                        <!-- Content Injected via JS -->
                    </div>

                    <!-- View: Discovery (Student - Reference Design) -->
                    <div id="view-discovery" class="hidden max-w-7xl mx-auto space-y-6 fade-in">
                        <div class="mb-2">
                            <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Discover Mentors</h1>
                            <p class="text-slate-500 mt-1 font-medium">Find experienced mentors who can guide your journey</p>
                        </div>
                        
                        <!-- Search & Filter Card -->
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm space-y-6">
                            <div class="space-y-2">
                                <label class="text-sm font-bold text-slate-900">Search</label>
                                <div class="relative">
                                    <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"></i>
                                    <input type="text" id="mentor-search" onkeyup="filterMentors()" placeholder="Search by name, role, or organization..." class="w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:bg-white transition-all text-sm font-medium">
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="text-sm font-bold text-slate-900">Filter by Expertise</label>
                                <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide" id="filter-chips">
                                    <!-- Chips injected via JS -->
                                </div>
                            </div>
                        </div>

                        <!-- Mentor Grid -->
                        <div id="mentor-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Cards injected via JS -->
                        </div>
                    </div>

                    <!-- View: Resources -->
                    <div id="view-resources" class="hidden max-w-6xl mx-auto space-y-8 fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Resource Vault</h1>
                                <p class="text-slate-500 mt-1 font-medium">Essential documents, schedules, and guidelines.</p>
                            </div>
                        </div>
                        <div id="resource-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
                    </div>

                </main>
            </div>
        </div>

        <!-- Announcement Modal -->
        <div id="announcement-modal" class="hidden fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl border border-slate-200 w-full max-w-lg shadow-2xl overflow-hidden scale-100 transition-transform">
                <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                    <h3 class="text-lg font-bold text-slate-800">New Broadcast</h3>
                    <p class="text-xs text-slate-500 mt-1">This will be visible to all students instantly.</p>
                </div>
                <div class="p-6">
                    <textarea id="announcement-text" class="w-full min-h-[160px] p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 text-sm font-medium resize-none" placeholder="Type your message here..."></textarea>
                </div>
                <div class="p-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
                    <button onclick="toggleAnnouncementModal(false)" class="px-5 py-2.5 text-slate-600 hover:bg-slate-200 rounded-lg font-semibold text-sm transition-all">Cancel</button>
                    <button onclick="submitAnnouncement()" class="px-5 py-2.5 bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg font-semibold text-sm transition-all shadow-md shadow-indigo-200">Publish Broadcast</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyBOSm_MWyZ1phOXRbPFv28JJ-DGMJB2yoI",
            authDomain: "buildit-6c866.firebaseapp.com",
            projectId: "buildit-6c866",
            storageBucket: "buildit-6c866.firebasestorage.app",
            messagingSenderId: "38864758161",
            appId: "1:38864758161:web:a3ca049c03bbe85acbe630",
            measurementId: "G-LRZX45VTDW"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = "buildit-unipath";

        // --- State ---
        let currentUser = null;
        let selectedRole = null;
        let profile = null;
        let mentorsList = []; 

        // --- Mock Data ---
        // Enhanced to match reference image fields
        const SAMPLE_MENTORS = [
            { id: 1, name: "Dr. Sarah Chen", title: "Senior ML Engineer", org: "TechCorp Inc.", expertise: ["Machine Learning", "Data Science", "Python"], available: true, capacity: "2/5", hours: "15 hours/month", exp: "8 years", color: "bg-purple-500", initials: "D" },
            { id: 2, name: "Prof. Michael Brown", title: "Professor of Computer Science", org: "State University", expertise: ["Web Development", "React", "Node.js"], available: true, capacity: "3/8", hours: "20 hours/month", exp: "12 years", color: "bg-indigo-500", initials: "P" },
            { id: 3, name: "Ms. Priya Desai", title: "Lead Product Designer", org: "Creative Studios", expertise: ["UI/UX", "Figma", "Research"], available: false, capacity: "5/5", hours: "10 hours/month", exp: "5 years", color: "bg-pink-500", initials: "M" },
            { id: 4, name: "Mr. David Lee", title: "Cloud Architect", org: "SkyNet Solutions", expertise: ["AWS", "DevOps", "Docker"], available: true, capacity: "1/4", hours: "12 hours/month", exp: "10 years", color: "bg-blue-500", initials: "M" }
        ];

        const SAMPLE_RESOURCES = [
            { title: "Academic Calendar 2024", type: "PDF", size: "2.4 MB", color: "text-red-500", icon: "file-text" },
            { title: "Semester 2 Syllabus", type: "PDF", size: "1.1 MB", color: "text-red-500", icon: "file-text" },
            { title: "Lab Safety Guidelines", type: "DOCX", size: "850 KB", color: "text-blue-500", icon: "file" },
        ];

        const MY_MENTEES = [
            { name: "Aarav Gupta", batch: "CS 2025", status: "On Track" },
            { name: "Sanya Verma", batch: "IT 2024", status: "Needs Review" },
            { name: "Rohan Das", batch: "CS 2025", status: "On Track" }
        ];

        const PENDING_TASKS = [
            { title: "Project Proposal Review - Aarav", due: "Today", type: "Review" },
            { title: "Approve Mentorship Request - John Doe", due: "Yesterday", type: "Request" },
            { title: "Mid-Term Grading", due: "In 2 days", type: "Submission" }
        ];

        // --- Initialization ---
        window.onload = async () => {
            lucide.createIcons();
            window.phoneEmailReceiver = (userObj) => { onVerified(); };

            const initAuth = async () => {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    try { await signInWithCustomToken(auth, __initial_auth_token); } 
                    catch (e) { await signInAnonymously(auth); }
                } else {
                     if (!auth.currentUser) await signInAnonymously(auth);
                }
            };
            await initAuth();

            onAuthStateChanged(auth, async (user) => {
                currentUser = user;
                if (!user) {
                    await signInAnonymously(auth);
                } else {
                    hideElement('loading-screen');
                    showElement('login-view');
                }
            });
        };

        // --- Core Logic ---
        window.handleRoleSelect = (role) => {
            selectedRole = role;
            document.getElementById('role-title').innerText = role === 'mentor' ? 'Faculty Verification' : 'Student Verification';
            hideElement('role-selection');
            showElement('verification-step');
            
            if (!document.getElementById('phone-email-script')) {
                const script = document.createElement('script');
                script.id = 'phone-email-script';
                script.src = "https://www.phone.email/verify_email_v1.js";
                script.async = true;
                document.body.appendChild(script);
            }
        };

        window.resetRole = () => {
            selectedRole = null;
            hideElement('verification-step');
            showElement('role-selection');
        };

        async function onVerified() {
            if (!currentUser || !selectedRole) return;
            hideElement('login-view');
            showElement('loading-screen');

            const userDocRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'profile', 'info');
            try {
                const snap = await getDoc(userDocRef);
                if (snap.exists()) {
                    profile = snap.data();
                } else {
                    profile = {
                        uid: currentUser.uid,
                        role: selectedRole,
                        name: selectedRole === 'mentor' ? 'Dr. Vikram Seth' : 'Aarav Gupta',
                        email: 'user@iilm.edu',
                        title: selectedRole === 'mentor' ? 'Faculty Member' : 'Student - Batch 2024',
                        createdAt: serverTimestamp()
                    };
                    await setDoc(userDocRef, profile);
                }
                initPortal();
            } catch (e) {
                console.error("Verification error", e);
                showToast("Verification failed. Please try again.", "error");
                showElement('login-view');
                hideElement('loading-screen');
            }
        }

        function initPortal() {
            hideElement('loading-screen');
            showElement('portal-layout');
            
            renderSidebar();
            
            document.getElementById('sidebar-name').innerText = profile.name;
            document.getElementById('sidebar-role').innerText = profile.title;
            document.getElementById('sidebar-avatar').innerText = profile.name[0];

            setupAnnouncementsListener();
            
            navigateTo('dashboard');
            
            if (profile.role === 'mentee') {
                mentorsList = SAMPLE_MENTORS;
                renderMentorGrid(mentorsList);
                renderFilterChips();
            }
            renderResources();
            renderDashboardContent();
        }

        function renderDashboardContent() {
            const container = document.getElementById('view-dashboard');
            
            if (profile.role === 'mentor') {
                // MENTOR DASHBOARD LAYOUT
                container.innerHTML = `
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                        <div>
                            <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Faculty Dashboard</h1>
                            <p class="text-slate-500 mt-1 font-medium">Manage your academic mentorships and broadcasts.</p>
                        </div>
                        <button onclick="toggleAnnouncementModal(true)" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-full font-bold shadow-lg shadow-indigo-200 transition-all flex items-center gap-2">
                            <i data-lucide="plus" class="w-5 h-5"></i> New Broadcast
                        </button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Left Column: Pending Actions & Mentees -->
                        <div class="lg:col-span-2 space-y-8">
                            <!-- Pending Tasks -->
                            <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-6">
                                <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2"><i data-lucide="inbox" class="text-amber-500 w-5 h-5"></i> Pending Actions</h3>
                                <div class="space-y-3">
                                    ${PENDING_TASKS.map(task => `
                                        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100 hover:border-indigo-200 transition-colors cursor-pointer">
                                            <div class="flex items-center gap-3">
                                                <div class="w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-xs font-bold text-slate-500">
                                                    ${task.type === 'Request' ? 'R' : 'S'}
                                                </div>
                                                <div>
                                                    <p class="text-sm font-bold text-slate-800">${task.title}</p>
                                                    <p class="text-xs text-slate-500">Due: ${task.due}</p>
                                                </div>
                                            </div>
                                            <i data-lucide="chevron-right" class="w-4 h-4 text-slate-400"></i>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <!-- My Mentees -->
                            <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-6">
                                <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2"><i data-lucide="users" class="text-indigo-600 w-5 h-5"></i> Assigned Mentees</h3>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left">
                                        <thead>
                                            <tr class="text-xs text-slate-400 uppercase tracking-wider border-b border-slate-100">
                                                <th class="pb-3 pl-2">Student</th>
                                                <th class="pb-3">Batch</th>
                                                <th class="pb-3">Status</th>
                                                <th class="pb-3 text-right">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-slate-100">
                                            ${MY_MENTEES.map(m => `
                                                <tr>
                                                    <td class="py-3 pl-2 font-bold text-slate-700">${m.name}</td>
                                                    <td class="py-3 text-sm text-slate-500">${m.batch}</td>
                                                    <td class="py-3"><span class="px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-[10px] font-bold uppercase">${m.status}</span></td>
                                                    <td class="py-3 text-right"><button class="text-indigo-600 text-xs font-bold hover:underline">View Profile</button></td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Broadcast Feed -->
                        <div class="lg:col-span-1">
                            <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden h-full">
                                <div class="p-6 border-b border-slate-100 flex items-center gap-2 bg-slate-50/50">
                                    <i data-lucide="rss" class="text-indigo-600 w-5 h-5"></i>
                                    <h3 class="font-bold text-slate-800">Your Broadcasts</h3>
                                </div>
                                <div id="broadcast-feed" class="divide-y divide-slate-100 max-h-[500px] overflow-y-auto">
                                    <!-- Dynamic Feed -->
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // STUDENT DASHBOARD LAYOUT (Similar to previous logic)
                 container.innerHTML = `
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                        <div>
                            <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Welcome Back</h1>
                            <p class="text-slate-500 mt-1 font-medium">Here's what's happening at IILM today.</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start">
                                <div><p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Active Mentors</p><h3 class="text-3xl font-black text-slate-900 mt-2">42</h3></div>
                                <div class="p-3 rounded-xl bg-indigo-50 text-indigo-600"><i data-lucide="users" class="w-6 h-6"></i></div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start">
                                <div><p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Tasks Due</p><h3 class="text-3xl font-black text-slate-900 mt-2">3</h3></div>
                                <div class="p-3 rounded-xl bg-amber-50 text-amber-600"><i data-lucide="check-square" class="w-6 h-6"></i></div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start">
                                <div><p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Updates</p><h3 id="announcement-count" class="text-3xl font-black text-slate-900 mt-2">0</h3></div>
                                <div class="p-3 rounded-xl bg-emerald-50 text-emerald-600"><i data-lucide="radio" class="w-6 h-6"></i></div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-slate-100 flex items-center gap-3">
                            <i data-lucide="rss" class="text-indigo-600 w-5 h-5"></i>
                            <h3 class="font-bold text-slate-800">Campus Broadcasts</h3>
                        </div>
                        <div id="broadcast-feed" class="divide-y divide-slate-100"></div>
                    </div>
                 `;
            }
            lucide.createIcons();
        }

        // --- Navigation ---
        window.navigateTo = (viewId) => {
            ['view-dashboard', 'view-discovery', 'view-resources'].forEach(id => hideElement(id));
            showElement(`view-${viewId}`);
            
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('bg-indigo-50', 'text-indigo-600');
                el.classList.add('text-slate-600', 'hover:bg-slate-50');
            });
            const activeBtn = document.getElementById(`nav-${viewId}`);
            if(activeBtn) {
                activeBtn.classList.remove('text-slate-600', 'hover:bg-slate-50');
                activeBtn.classList.add('bg-indigo-50', 'text-indigo-600');
            }
            const titles = { 'dashboard': 'Dashboard', 'discovery': 'Discover Mentors', 'resources': 'Resource Vault' };
            document.getElementById('page-title').innerText = titles[viewId] || 'Portal';
        };

        function renderSidebar() {
            const nav = document.getElementById('sidebar-nav');
            let html = `
                <button id="nav-dashboard" onclick="navigateTo('dashboard')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all mb-1">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Dashboard
                </button>
            `;
            if (profile.role === 'mentee') {
                html += `
                    <button id="nav-discovery" onclick="navigateTo('discovery')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all mb-1">
                        <i data-lucide="search" class="w-5 h-5"></i> Find Mentors
                    </button>
                `;
            }
            html += `
                <button id="nav-resources" onclick="navigateTo('resources')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all mb-1">
                    <i data-lucide="folder-open" class="w-5 h-5"></i> Resources
                </button>
            `;
            nav.innerHTML = html;
            lucide.createIcons();
        }

        // --- Discovery Module (Updated with Reference Design) ---
        function renderMentorGrid(list) {
            const grid = document.getElementById('mentor-grid');
            if(list.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center py-10 text-slate-400 font-medium">No mentors found matching criteria.</div>`;
                return;
            }
            grid.innerHTML = list.map(m => `
                <div class="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm hover:shadow-lg transition-all flex flex-col justify-between">
                    <div>
                        <div class="flex items-start gap-4 mb-4">
                            <div class="mentor-card-avatar ${m.color} shrink-0">
                                ${m.initials}
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-900 text-lg leading-tight">${m.name}</h4>
                                <p class="text-slate-500 font-medium text-sm">${m.title}</p>
                            </div>
                        </div>
                        
                        <p class="text-slate-500 text-sm mb-6">${m.org}</p>
                        
                        <div class="space-y-2 mb-6">
                            <div class="flex items-center gap-3 text-sm text-slate-600">
                                <i data-lucide="star" class="w-4 h-4 text-slate-400"></i> ${m.exp} experience
                            </div>
                            <div class="flex items-center gap-3 text-sm text-slate-600">
                                <i data-lucide="clock" class="w-4 h-4 text-slate-400"></i> ${m.hours} available
                            </div>
                             <div class="flex items-center gap-3 text-sm text-slate-600">
                                <i data-lucide="users" class="w-4 h-4 text-slate-400"></i> ${m.capacity} mentees
                            </div>
                        </div>
                    </div>

                    <div>
                        <p class="text-xs font-bold text-slate-900 mb-2">Expertise</p>
                        <div class="flex flex-wrap gap-2">
                            ${m.expertise.map(tag => `<span class="px-3 py-1 bg-slate-100 rounded-full text-xs font-semibold text-slate-600">${tag}</span>`).join('')}
                            <span class="px-3 py-1 bg-slate-100 rounded-full text-xs font-semibold text-slate-600">+1</span>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderFilterChips() {
            const allTags = [...new Set(SAMPLE_MENTORS.flatMap(m => m.expertise))];
            const container = document.getElementById('filter-chips');
            container.innerHTML = `<button onclick="filterByTag('all')" class="chip active px-4 py-2 rounded-full bg-blue-600 text-white text-sm font-semibold whitespace-nowrap transition-colors">All</button>` + 
                allTags.map(tag => `<button onclick="filterByTag('${tag}')" class="chip px-4 py-2 rounded-full bg-white border border-slate-200 text-slate-700 text-sm font-semibold whitespace-nowrap hover:bg-slate-50 transition-colors">${tag}</button>`).join('');
        }

        window.filterByTag = (tag) => {
            document.querySelectorAll('.chip').forEach(c => {
                c.className = "chip px-4 py-2 rounded-full bg-white border border-slate-200 text-slate-700 text-sm font-semibold whitespace-nowrap hover:bg-slate-50 transition-colors";
            });
            event.target.className = "chip px-4 py-2 rounded-full bg-blue-600 text-white border border-blue-600 text-sm font-semibold whitespace-nowrap transition-colors";

            if (tag === 'all') {
                renderMentorGrid(SAMPLE_MENTORS);
            } else {
                const filtered = SAMPLE_MENTORS.filter(m => m.expertise.includes(tag));
                renderMentorGrid(filtered);
            }
        };

        window.filterMentors = () => {
            const query = document.getElementById('mentor-search').value.toLowerCase();
            const filtered = SAMPLE_MENTORS.filter(m => 
                m.name.toLowerCase().includes(query) || 
                m.title.toLowerCase().includes(query) || 
                m.org.toLowerCase().includes(query) ||
                m.expertise.some(e => e.toLowerCase().includes(query))
            );
            renderMentorGrid(filtered);
        };

        // --- Resources Module ---
        function renderResources() {
            const grid = document.getElementById('resource-grid');
            grid.innerHTML = SAMPLE_RESOURCES.map(r => `
                <div class="bg-white p-5 rounded-2xl border border-slate-200 hover:border-indigo-300 hover:shadow-md transition-all cursor-pointer group" onclick="downloadResource('${r.title}')">
                    <div class="flex items-start justify-between mb-4">
                        <div class="p-3 bg-slate-50 rounded-xl group-hover:bg-indigo-50 transition-colors">
                            <i data-lucide="${r.icon}" class="${r.color} w-6 h-6"></i>
                        </div>
                        <i data-lucide="download" class="w-4 h-4 text-slate-300 group-hover:text-indigo-600"></i>
                    </div>
                    <h4 class="font-bold text-slate-800 text-sm mb-1 truncate">${r.title}</h4>
                    <p class="text-xs text-slate-400 font-bold">${r.type} â€¢ ${r.size}</p>
                </div>
            `).join('');
            lucide.createIcons();
        }

        window.downloadResource = (title) => { showToast(`Downloading: ${title}...`, 'success'); };

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const icon = type === 'success' ? 'check-circle' : 'info';
            const bgClass = type === 'success' ? 'bg-emerald-600' : 'bg-slate-800';
            toast.className = `${bgClass} text-white px-4 py-3 rounded-xl shadow-xl flex items-center gap-3 transform transition-all duration-300 translate-y-10 opacity-0 pointer-events-auto min-w-[300px]`;
            toast.innerHTML = `<i data-lucide="${icon}" class="w-5 h-5"></i> <span class="text-sm font-semibold">${message}</span>`;
            container.appendChild(toast);
            lucide.createIcons();
            requestAnimationFrame(() => toast.classList.remove('translate-y-10', 'opacity-0'));
            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // --- Firebase Listeners ---
        function setupAnnouncementsListener() {
            const annCol = collection(db, 'artifacts', appId, 'public', 'data', 'announcements');
            onSnapshot(annCol, (snap) => {
                const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const sorted = data.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                
                const countEl = document.getElementById('announcement-count');
                if (countEl) countEl.innerText = sorted.length;
                renderFeed(sorted);
            }, (error) => console.error(error));
        }

        function renderFeed(list) {
            const container = document.getElementById('broadcast-feed');
            if (!container) return;
            
            if (list.length === 0) {
                container.innerHTML = '<div class="p-8 text-center text-slate-400 text-sm font-medium">No updates yet.</div>';
                return;
            }
            container.innerHTML = list.map(ann => `
                <div class="p-6 hover:bg-slate-50 transition-colors group">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-indigo-600"></span>
                            <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">${ann.date || 'Today'}</span>
                        </div>
                        <span class="text-[10px] font-bold text-indigo-200 group-hover:text-indigo-600 transition-colors uppercase tracking-widest">Official</span>
                    </div>
                    <p class="text-slate-800 text-sm leading-relaxed font-medium">${ann.content}</p>
                    <div class="mt-3 flex items-center gap-2 text-xs text-slate-400 font-bold">
                        <i data-lucide="user" class="w-3 h-3"></i> ${ann.authorName || 'Faculty'}
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        window.toggleAnnouncementModal = (show) => {
            const modal = document.getElementById('announcement-modal');
            if (show) modal.classList.remove('hidden');
            else modal.classList.add('hidden');
        };

        window.submitAnnouncement = async () => {
            const text = document.getElementById('announcement-text').value;
            if (!text.trim()) return;

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'announcements'), {
                    content: text,
                    authorId: currentUser.uid,
                    authorName: profile.name,
                    createdAt: serverTimestamp(),
                    date: new Date().toLocaleDateString()
                });
                document.getElementById('announcement-text').value = '';
                toggleAnnouncementModal(false);
                showToast("Broadcast published successfully!", "success");
            } catch (e) { 
                console.error(e);
                showToast("Failed to publish.", "error");
            }
        };

        window.logout = () => {
            selectedRole = null;
            profile = null;
            hideElement('portal-layout');
            showElement('login-view');
            resetRole();
        };

        function showElement(id) { document.getElementById(id).classList.remove('hidden'); }
        function hideElement(id) { document.getElementById(id).classList.add('hidden'); }

    </script>
</body>
</html>
